# SSH

1. ダイナミックローカルポートフォワーディングを有効化する。  
ターゲットIPのローカルサービスなど、外部から直接アクセスできないポートにattackerマシンからアクセスしたいときに使える。  
以下の設定により、localhost:9050経由のターゲット宛て通信はすべて内部ポートに動的にフォワーディングされる。  
proxychainsの設定をしないとlocalhost:9050宛ての通信にならないので注意。  
proxychainsしなくても、nmap localhost:9050 -p 80とやっても同じことではある。ただ面倒。
```
ssh -D 9050 hoge<ターゲットIP>
```



2. ダイナミックリモートポートフォワーディングを有効化する。pivotしたいNWとattacker側から現在接続できるIPの2つのNICを指定する。  
以下の場合、pivot hostは内部IPとattackerから接続できるIPの2つを持っている。ピボットしたい先のNWと面するIPを-Rの後ろに指定。  
そのIPの8080ポートに行った通信は、全てattackerマシンの8000にフォワーディングされる。  
これによってattackerから直接接続できないNW内のマシンからattackerのリバースシェルペイロードを落としてくるといったことができるようになる。
```
ssh -R <pivot hostの内部IP>:8080:0.0.0.0:8000 hoge@<pivot hostのattackerから接続できるIP>
```