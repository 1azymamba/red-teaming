# Living Off the Land
外部からツールをターゲットホストに落とすと、ステルス性が大きく損なわれる可能性がある。  
Windows組み込みのツールセットを使うだけで攻撃を完結できるのが最も理想的ではある。  
  
## コマンド集
1. PCのホスト名をプリント。
```
hostname
```

2. OSのバージョンとリビジョンレベルを出力
```
[System.Environment]::OSVersion.Version
```

3. ホストに適用されたパッチとホットフィックスをprint
```
wmic qfe get Caption,Description,HotFixID,InstalledOn	
```

4. ipアドレスを出力
```
ipconfig /all
```

5. 現在のセッションの環境変数のリストを表示する。(cmdから実行)
```
set 
```

6. ホストが属するドメイン名を表示。また、ホストがチェックインするDCの名前を表示。(いずれもcmdから実行)
```
echo %USERDOMAIN%
echo %logonserver%
```

7. 上記の情報を全て出力してくれる。一つのコマンドで情報を取得できるためステルス性も高い。
```
systeminfo
```

8. Powershellは複数のバージョンがインストールされていることが少なくない。version 3等上位のバージョンからversion2にダウングレードさせることが可能。  
Powershellのイベントログ機能はversion 3から導入されているため、version 2以下にすることで、Powershellで実行するコマンドをWindowsイベントログに残さないようにすることができる。  
以下のコマンドでダウングレードした場合、いかのコマンド実行を行ったというログまでがWinイベントログに残る。
```
powershell.exe -version 2
```

9. 他のユーザが現在同じホストにアクセスしていないかをチェックするコマンド。  
同じホストに他のユーザが同時にアクセスしていると、ポップアップウィンドウが表示されたり、ユーザがセッションからログアウトしたときに接続が失われる可能性がある。  
そのためアクセスを取った時は、Activeなセッションが自分一人であることが、ステルス性の観点からは望ましい。
```
qwinsta
```

10. ドメイン内のユーザリストを取得また、ドメイン内のコンピュータリストを取得。
```
dsquery user
dsquery computer
```