# Casino
[Casino](https://www.youtube.com/watch?v=ZwYqDZOvUpY&list=PLeSXUd883dhjhV4MokruWYQWnhxsCPyUY&index=30)

1. 22, 80, 9000があいてる。900はフィルターされているが、フィルターされているポートはローカルからのアクセスのみ許可することがある。これはSSRFとかで使える可能絵師がある。頭の端に入れておいて80から見ていく。
2. ブラウザから80を見ていくと、チームメンバー的な人の顔と名前が書いてある。また、Flaskを使っているらしいことも書いてある。
3. gobusterでbig.txtを使ってスキャンする。
4. その間にブラウザから検索欄とかで<h1>a</h1>みたいにして脆弱な部分が無いか手動でチェックしてみる。
5. Flaskを実行しているアプリケーションなので脆弱な部分が無いかPayloadAllthingsで調べてみると、テンプレートインジェクションというのができるらしいことが分かる
6. configの情報などを見ることができるので、そこでSECRETKEYとかもわかる。
7. grabber.phpというのをローカルで作って、ターゲットにXSSをさせて、<script></script>とやって、ファイルをgrabber.phpをダウンロードさせ、それを使ってターゲットのadminが持つCookieを取得する
8. Cookieはb64されているが、Elichのパスワードらしきものが出てくる
9. gobusterが終わったので、Elichと先ほどのCookieをデコードしたパスワードで、logonからログイン
10. /playにAPIの文字列があり、開発用のAPIっぽい。Burpで調査すると、先ほどのターゲット上でlocalhost:9000にアクセスさせるとSSRFを使って外部からサイトにアクセスできる
11. SSRFでlocalhost:9000/adminにアクセス
12. adminのページを見ていると、パラメータにcmdをとってコード実行できるぽいことが分かるので、これを使ってgreyユーザの.sshフォルダを作成する。
13. ローカルでsshキーを作成して、ローカルではb64してからアップロードして、アップロード後はデコードするようにしておく
14. sshでid_rsaを使ってgreyにアクセスできるようになるので、アクセスする。パスフレーズは不要。
15. greyの/home/adminPanelを見に行くと、gitフォルダがあるので、git diffとgit showでcommitの中身を確認していく
16. carlaユーザとパスワードが平文でgit showから見れるので、su carlaで横展開する。sudo -lすると、carlaはroot権限で.pyのファイルをパスワードなし実行できるのが分かる
17. このpythonファイルはモジュールをインポートしていて、PYTHONPATHの環境変数には特に何も設定されていない。
18. このような場合、pythonの使うインポート用モジュールを偽造することで、pythonファイル自体の書き換え権限が無くてもosコマンドを実行させることができる。
19. つまり、root権限でpythonファイルを実行できるが書き込み権限がない=>pythonファイルの使うモジュールを偽造するファイルを作成する=>モジュールの中でosコマンドを実行させるようなコードを書き込む=>root権限でシェルを取れる。