# Medtech web server
## Time
foothold = 2H  
privesc = none

※ディスコヒントあり、Attack surfaceの発見までは自力、SQLi動かなくてヒント。privescはこのマシンにない。

## 教訓
1. blind sqliだったらxp_cmdshell！！

## 手順
1. いつものrustscan。80, 135, 139, 445, 5985などいろいろ開いてる。
2. smbclientとrpcclientでのanonymousログオンはだめっぽい。
3. とりまWebにアクセスできた。リッチなWeb。URLの拡張子から.aspxで動いてる風。サーバはIIS10.0
4. 手動列挙しながらffufをぶっぱなす。
5. 手動列挙中にAboutからユーザ名一人分だけそれっぽい？のを見つけたのでメモ。わんちゃんあとでADの攻撃とかで使えるかもなので。
6. aspxの拡張子を書き換えてwebshellとかかなあとか、ファイルアップロードどっからかできねえかなあ、とか、LFIとか狙えんのかなあとか探すもできそうなAttack surfaceが見つからず。
7. そうこうしてるうちにffufが終わる。login.aspxが怪しいので取りまみる。
8. ユーザ名とパスワード入力できる。シングルクオーテーション入れたらエラーでたのでSQLiでいけそう。
9. SQLi狙うにあたって、Error-based SQLiしかやったことなかったのでエラー表記見ながらいろいろ試す。今こそprogateとHTBのトレーニングの成果を、、！！
10. order byとUNIONでカラム数を特定するやり方は最近知ってたのでそれを使っていい感じにカラム数を特定。いけるのでは、、！？
11. かなり時間を溶かしてあきらめる。ディスコをみた。
12. そもそもこれはエラー内容をWeb上に吐いてくるだけで挙動やテーブル、クエリの結果を表示してくれないらしい。これがBlind sqliらしい。
13. blindなのでターゲットでxp_cmdshellを有効にしてコマンド実行が動いているかをチェックするのが正しいアプローチらしい。ちなみにここまでsqlmapもやってたがツールだとシェル獲得うまくいかなかった。
14. xp_cmdshellの有効化は調べるとすぐ出てくるので、それでコマンド実行してmeterpreterのペイロード実行させてシェルゲット。それと、xp_cmdshellはsysadmin権限が無いとそもそも有効化できない。今回はたまたまあったからラッキー。
15. 権限昇格はなさげなのでとりあえずproofとっておわり。

## 総括
1. まあディスコ見ちゃったけどこのまえUNIONとorder by勉強してたのは良かった
2. blindsqlっていうのを見分けたらすぐにxp_cmdshellやるかっていう考えが出てくる必要がある
3. blindsqli勉強できてよかた