# Crystal
## Time
Ini Access = 2h 10min  
Privesc = 3h 20min  
Total hour = 5.5h
※iniはディスコなし、privescはディスコあり

## 教訓
- 取得した認証情報は全部のユーザに試せ。
- 列挙の見落としをするな。めっちゃメモれ。
- zip2johnの存在を忘れるな。
- SSHで全く応答がなかったらわんちゃんNWエラーを疑え。
- あとpspy結構便利。
- 一応/opt/は見とけ。

## Summary
1. いつも通りnmapをかます。21,22,80が空いてる。
2. nmapでftpのanonymous logonが有効になっている記述がないものの、とりま手動で試してみる。=>接続できず。
3. SSHがAttack VetorになったことがないのでPort 80を見るしか。FFUFを走らせながら手動で眺めていく。
4. 手動列挙だとパストラバーサルとか引っかからず。
5. しばらくしたらFFUFが終わった。あと、nmapで.git found!っていう表示が出てることに気付いた。FFUFにも.gitが出てた。
6. .gitにめちゃくちゃ開発情報みたいなのが詰まってる。
7. .gitのフォルダ内をしらみつぶしに全部見た。これだけだとイマイチ良い情報見つからず。ユーザ名っぽいのとかは手に入った。
8. cloneはできないけど.gitフォルダを指定してwgetできそうだなと思ったので調べてやったらwgetできた。手動でWebから.gitを見てるのと、ローカルに.gitを落とすのだとリポジトリとか差分の表示が違う。.gitを見つけたら絶対ローカルに落とした方が良い。
9. ローカルに落としてからVSCodeでリポジトリをみてた。git logとかgit statusのコマンドで過去のコミット履歴を眺める。security update!みたいなコメントがあったのでそれ以前のコミットに戻せればなんかありそう。
10. git checkout <commit number>ってやったら過去のコミットに戻れた。そこにあったphpとかsql系のファイルで認証情報を取得できたのでsshでIni Accessはげっつ。ディスコ見ないでいけたので良かった。
-------------  
11. とりまlinpeasを回してみてみる。色々見つかるけどいっつもどれからやればいいか分からない。まずは.bashhistoryとかそういう系で平文の認証情報残ってないか色々見てみる。=>なんも見つからず。
12. 列挙してたらchloeっていうユーザだけsudo権限持ってたので、chloeの認証情報が分かればrootアクセスいける。chloe狙い。
13. Aeroでの教訓を生かしてfind -perm u=s -type f >2/dev/nullみたいなコマンドでSUIDのチェックをしてみた。でも前みたいにバージョンがめっちゃ見えるサービスとかは見つからず。
14. configとかweb系のフォルダも見たけどめぼしい情報が見つからず。ここでディスコに逃げる。/opt/に怪しいzipがある。
15. zipをローカルに落とした。そのあとzipがぶっ壊れてるものの、zip2johnでクラックいける。
16. zipの中身を色々見てるとsql系のファイルに認証情報がある。これがchloeのやつっぽい。この認証情報見つけるの意外と1行ずつちゃんと見ないと見つからないので注意。
17. chloeでsudoしておわり。