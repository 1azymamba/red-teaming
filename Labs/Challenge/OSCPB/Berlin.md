# Berlin

## Time
***
foothold, privescディスコあり

## 手順
1. rustscanすると8080があいていて、Apache Commonsぽい。この脆弱性調べるとすぐ出るのでそれでいい感じにちゃんとURLエンコードしてシェルを取る。chmodとかbashを使うとかの細部に神は宿る。
2. ligoloでsudo ip route add 240.0.0.1 dev ligoloをする。この時ligoloの機能として、240.0.0.1は、ターゲットに対するローカルポートフォワーディングを行うためのものを指す。240.0.0.1はligoloでハードコードされたものなので、これを指定すると、エージェント側(127.0.0.1)にパケットをルーティングするようになっている。
3. nc -nvとrustscanで、ターゲットのjdwpポートにKaliからアクセスできることをまずは確認する。ローカルポートフォワーディングがちゃんとできてそうなら、エクスプロイトのPoCをｷﾞｯﾊﾌﾞからもってきてpython2でぶっ放す。
4. コード実行でシェル取ろうとするとNWエラーなのかそもそもコード実行できてないのかわかりづらいので、コツはターゲットホスト上で結果を確認できるcmdを実行すること。例えばchmodでSUIDセットとか。
5. SUIDセットがうまくいったりいかなかったりするが、デバッガのブレークポイント問題もあるっぽいので失敗することもあるのかも。とにかくこれでrootとっておわり

## 総括
- ポートフォワーディングむずいけどこれのおかげで慣れてきたので良マシン。
- ターゲットLinux上でコマンド実行するときに、bashつけたりつけなかったりするのがみそ
- ローカルポートフォワーディングできるようになったら、AD環境ターゲットの時みたいにもう一回ターゲットホストに対してrustscanしてopen portを確認するのがいい。