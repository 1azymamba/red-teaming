# Exfiltrated
## Time
iniaccess = 40min
privesc = 110min
  
※privescはヒントあり。脆弱なshファイルの存在と悪用方法まで理解し、そのあとエクスプロイトを調べてる時にネタバレ見た

## 教訓
- public exploitを詳細に調べる。エラーとディグの根気強さ
- 割と自分で作ったchecklistが有能。あれが無理だったら手詰まり。そしたら最後はlinPeasするしか。
- Aeroでもそうだったが、リバースシェルするときのポート大事。今回は教訓を活かせた。ターゲットで開いているポートをリバースシェルの待ち受けポートに使うのがベスト。
- IPでアクセスするとリダイレクトされる、みたいなやつは/etc/hostsでの名前解決をちゃんと書くこと。

## 手順
1. いつものrustscanからのnmap。22と80があいてた。
2. 22は大体攻撃につながらないので、ffufで80をスキャンしながら手動で列挙。rustscanの結果からrobots.txtで不許可になっているディレクトリが見えた。
3. robots.txtにアクセスして、disallowになっているディレクトリを全部見る。そのうち、/panel/がログインページみたいになっていた。
4. ログインページが見つかったのでとりあえずデフォルトcredentialsでディグ。見つかるのでそれ試したら管理者ログインできた。
5. また、ターゲットのCMSのバージョンもログインページから見えていて、そのCMSのバージョンでExploitをディグ。でてきたpublic exploitを使ってみた。そしたらwebshellがとれた。
6. webshell取った後にreberse generaterとかいう便利なサイトでpythonのシェルにアップグレード。そろぼちpriv esc
7. checklistに書いてあることを試していく。linpeasは見るのがだるいので最後まで使わない。
8. まずはSUIDとwritableファイルのチェック。なんもなし。次にsudo -l。これもそもそもsudoするためのパスワード分からず。
9. cronのチェック。怪しいの発見。hogehoge.shみたいなファイルがroot権限で実行されてるのでそれをcatして中身を見てみる。
10. ls -lで権限も確認。読み取り権限だけで書き込みはできない。実行はできる。cron見た感じ1分おきにroot権限で実行されてるshファイルだった。
11. 中のシェルスクリプトを見た感じ、なんかjpgのファイルアップロードでroot実行できそう。ファイル名にjpegって入れればいいのかなと思ったけど、exiftoolでのメタデータ抽出だからファイル名だけじゃjpg判定してくれなさそう。
12. exiftoolのexploitをディグるとなんか出てくるのでそのツールを使うとjpgのリバースシェルを作れる。
13. アップロードしてrlwrap nc -lvnp 80して1分待てばroot取得。  

## 総括
- 完全ノーヒントではなかったけど、時間短く終わったし結構怪しいポイントの勘みたいなのがついてきた感ある。cron見つけられたのもそう。