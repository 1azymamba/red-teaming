# Amaterasu
## Time
Ini Access = 2H 20min
PrivEsc = 45min

※iniaccessはヒントあり、privescはノーヒント

## 教訓
- sshのアップロードで上書きするやつ、authorized_keysとssh-keygenの使い方覚えておけ。
- curlでPOSTするとき、パラメータ等の書き方は応答を見ながら試行錯誤しろ。
- 権限昇格のパートはかなり良かった。

## 手順

1. とりまnmapとrustscanをぶん回す。やってた思ったけどrustscan強すぎ。マジ早い。TCPスキャンはrustscanしてUDPスキャンは普通にnmapってのが良さげ。
2. rustscanの結果を見てみる。 21ポートFTPはバージョンの脆弱性特になさそう。FTPへのanonymousログインは有効だけどpassive modeになっててファイルの読み取りとかはできず。rabit hallっぽいから無視。
3. 次に25022ポート。OpenSSHが動いてる。とりまここもバージョンの脆弱性はなさそう。25022ポートでSSH動いてるのが変だなと思いつつもここから初期侵入つなげられたことが無いので無視。
4. 33414ポート。Webサーバが走ってるものの普通にアクセスすると404でnot found。でもスキャン結果をよく見るとPythonのバージョンとWerkzeugのバージョンが書いてある。怪しいと思いつつメモって次のポートへ。
5. 40080ポート。Apache2.4.53が走ってるぽい。Apacheの脆弱性はなさそう。ffuf回しながら手動で色々見るものなんもなし。
6. さっきの33414ポートが怪しい。ffuf回しながらpythonとかWerkzeugの脆弱性をでぃぐる。Fluskっぽいかも。
7. Fluskの脆弱性とか調べてみたけどあんまりそれらしきもの見当たらず。そうこうしてるうちにffufが終わったので見てみる。
8. /helpと/infoとかいうエンドポイントがあるので見てみると、ディレクトリの列挙とファイルアップロードができるぽい。この時点で/homeの下にユーザ名を発見。
9. catコマンドは使えずdirコマンドしか使えない。ファイルアップロードのエンドポイントAPIにcurlして色々やりながらファイルアップロードを試す。
10. ここでパラメータ関連のやつがうまくいかずヒントを見ながらファイルアップロードを行う。./sshにauthorized_keysをアップロードするのが正解。ローカルでssh-keygenしてid_rsa.pubを.txtにしてauthorized_keysとしてアップロード。
11. alfredoとしてSSHできる。
=====
12. 権限昇格狙っていく。THMの成果を見せるとき。色々試していく中で、crontabが怪しかった。
13. root権限で毎分実行される.shファイルがあり、それには書き込みができなかった。しかし環境変数としてPATHが指定されていて、このPATHには現在のユーザで書き込みが可能。
14. 環境変数に設定されてるPATHに移動して、root権限で実行されてるコマンドと同じ名前のファイルを生成する。.shファイルを生成し、そこに色々書き込む。
15. 書き込んでから1,2分待つと、root配下のファイルなどをリダイレクトできてるっぽいのでroot権限で.shファイルが実行されてるぽい。これでproof.txtを取って終わり。